<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Covariance Structures</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>






<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
margin-bottom: 0em;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Covariance Structures</h1>


<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a>
<ul>
<li><a href="#covariance-and-correlation-matrices" id="toc-covariance-and-correlation-matrices">Covariance and Correlation
Matrices</a></li>
<li><a href="#transformation-to-variance-parameters" id="toc-transformation-to-variance-parameters">Transformation to
Variance Parameters</a></li>
</ul></li>
<li><a href="#covariance-structures" id="toc-covariance-structures">Covariance Structures</a>
<ul>
<li><a href="#unstructured-us" id="toc-unstructured-us">Unstructured
(<code>us</code>)</a></li>
<li><a href="#homogeneous-ad-and-heterogeneous-ante-dependence-adh" id="toc-homogeneous-ad-and-heterogeneous-ante-dependence-adh">Homogeneous
(<code>ad</code>) and Heterogeneous Ante-dependence
(<code>adh</code>)</a></li>
<li><a href="#homogeneous-toep-and-heterogeneous-toeplitz-toeph" id="toc-homogeneous-toep-and-heterogeneous-toeplitz-toeph">Homogeneous
(<code>toep</code>) and Heterogeneous Toeplitz
(<code>toeph</code>)</a></li>
<li><a href="#homogeneous-ar1-and-heterogeneous-ar1h-autoregressive" id="toc-homogeneous-ar1-and-heterogeneous-ar1h-autoregressive">Homogeneous
(<code>ar1</code>) and Heterogeneous (<code>ar1h</code>)
Autoregressive</a></li>
<li><a href="#homogeneous-cs-and-heterogeneous-csh-compound-symmetry" id="toc-homogeneous-cs-and-heterogeneous-csh-compound-symmetry">Homogeneous
(<code>cs</code>) and Heterogeneous (<code>csh</code>) Compound
Symmetry</a></li>
</ul></li>
<li><a href="#spatial-covariance-structure" id="toc-spatial-covariance-structure">Spatial Covariance Structure</a>
<ul>
<li><a href="#spatial-exponential-sp_exp" id="toc-spatial-exponential-sp_exp">Spatial exponential
(<code>sp_exp</code>)</a></li>
</ul></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>

<p>Here we describe the covariance structures which are currently
available in <code>mmrm</code>.</p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>We use some concepts throughout the different covariance structures
and introduce these here.</p>
<div id="covariance-and-correlation-matrices" class="section level2">
<h2>Covariance and Correlation Matrices</h2>
<p>The symmetric and positive definite covariance matrix <span class="math display">\[
\Sigma = \begin{pmatrix}
\sigma_1^2 &amp; \sigma_{12} &amp; \dots &amp; \dots &amp; \sigma_{1m}
\\
\sigma_{21} &amp; \sigma_2^2 &amp; \sigma_{23} &amp; \dots &amp;
\sigma_{2m}\\
\vdots &amp; &amp; \ddots &amp; &amp; \vdots \\
\vdots &amp; &amp; &amp; \ddots &amp; \vdots \\
\sigma_{m1} &amp; \dots &amp; \dots &amp; \sigma_{m,m-1} &amp;
\sigma_m^2
\end{pmatrix}
\]</span> is parametrized by a vector of variance parameters <span class="math inline">\(\theta = (\theta_1, \dotsc,
\theta_k)^\top\)</span>. The meaning and the number (<span class="math inline">\(k\)</span>) of variance parameters is different
for each covariance structure.</p>
<p>In many covariance structures we use the decomposition <span class="math display">\[
\Sigma = DPD
\]</span> where the diagonal standard deviation matrix is <span class="math display">\[
D = \begin{pmatrix}
\sigma_1 &amp; 0 &amp; \cdots &amp; &amp; 0 \\
0 &amp; \sigma_2 &amp; 0 &amp; \cdots &amp; 0 \\
\vdots &amp; &amp; \ddots &amp; \ddots &amp; \vdots \\
&amp;  &amp; &amp; \sigma_{m-1} &amp; 0 \\
0 &amp; \cdots &amp; &amp; 0 &amp; \sigma_m
\end{pmatrix}
\]</span> with entries <span class="math inline">\(\sigma_i &gt;
0\)</span>, and the symmetric correlation matrix <span class="math inline">\(P\)</span> is <span class="math display">\[
P = \begin{pmatrix}
  1 &amp; \rho_{12}   &amp; \rho_{13} &amp; \cdots &amp; \cdots &amp;
\rho_{1,m-1} \\
  \rho_{12} &amp; 1      &amp; \rho_{23} &amp; \ddots &amp;        &amp;
\vdots \\
  \rho_{13} &amp; \rho_{23}      &amp; \ddots &amp; \ddots &amp; \ddots
&amp; \vdots \\
\vdots &amp; \ddots &amp; \ddots &amp; \ddots &amp; \rho_{m-2,m-1} &amp;
\rho_{m-2,m} \\
\vdots &amp;        &amp; \ddots &amp; \rho_{m-2,m-1}    &amp;
1    &amp; \rho_{m-1,m} \\
\rho_{1, m-1} &amp; \cdots &amp; \cdots &amp; \rho_{m-2,m} &amp;
\rho_{m-1,m}    &amp; 1
\end{pmatrix}
\]</span> with entries <span class="math inline">\(\rho_{ij} \in (-1,
1)\)</span>. Since these covariance structures assume different
variances for each time point they are called “heterogeneous” covariance
structures. Assuming a constant <span class="math inline">\(\sigma =
\sigma_1 = \dotsb = \sigma_m\)</span> gives a “homogeneous” covariance
structure instead.</p>
</div>
<div id="transformation-to-variance-parameters" class="section level2">
<h2>Transformation to Variance Parameters</h2>
<p>For standard deviation parameters <span class="math inline">\(\sigma\)</span> we use the natural logarithm <span class="math inline">\(\log(\sigma)\)</span> to map them to <span class="math inline">\(\mathbb{R}\)</span>. For correlation parameters
<span class="math inline">\(\rho\)</span> we consistently use the
transformation <span class="math display">\[
\theta = f(\rho) = \mathop{\mathrm{sign}}(\rho) \sqrt{\frac{\rho^2}{1 -
\rho^2}}
\]</span> which maps the correlation parameter to <span class="math inline">\(\theta \in \mathbb{R}\)</span>. It has the inverse
<span class="math display">\[
\rho = f^{-1}(\theta) = \frac{\theta}{\sqrt{1 + \theta^2}}.
\]</span> This is important because the resulting variance parameters
<span class="math inline">\(\theta\)</span> can be optimized without
constraints over the whole of <span class="math inline">\(\mathbb{R}\)</span>.</p>
</div>
</div>
<div id="covariance-structures" class="section level1">
<h1>Covariance Structures</h1>
<div id="unstructured-us" class="section level2">
<h2>Unstructured (<code>us</code>)</h2>
<p>Any covariance matrix can be represented by this saturated
correlation structure. Here <span class="math inline">\(k = m (m+1) /
2\)</span>. See the <a href="algorithm.html">algorithm vignette</a> for
details.</p>
</div>
<div id="homogeneous-ad-and-heterogeneous-ante-dependence-adh" class="section level2">
<h2>Homogeneous (<code>ad</code>) and Heterogeneous Ante-dependence
(<code>adh</code>)</h2>
<p>The ante-dependence correlation structure <span class="citation">(Gabriel 1962)</span> is useful for balanced designs
where the observations are not necessarily equally spaced in time. Here
we use an order one ante-dependence model, where the correlation matrix
<span class="math inline">\(P\)</span> has elements <span class="math display">\[
\rho_{ij} = \prod_{k=i}^{j-1} \rho_k.
\]</span> So we have correlation parameters <span class="math inline">\(\rho_k\)</span>, <span class="math inline">\(k =
1, \dotsc, m-1\)</span>.</p>
<p>We use a heterogeneous covariance structure to allow for different
within subject variances. So here we can identify <span class="math display">\[
\theta = (\log(\sigma_1), \dotsc, \log(\sigma_m), f(\rho_1), \dotsc,
f(\rho_{m-1}))
\]</span> and we have in total <span class="math inline">\(2m -
1\)</span> variance parameters. Assuming a constant variance yields a
homogeneous ante-dependence covariance structure with total <span class="math inline">\(m\)</span> variance parameters.</p>
<p>Note our naming convention for the homogeneous and heterogeneous
covariance structures that a suffix <code>h</code> is used to denote the
heterogeneous version, e.g, <code>ad</code> for homogeneous and
<code>adh</code> for heterogeneous ante-dependence. This is different
from the name used in SAS for ante-dependence covariance structure,
where <code>ANTE(1)</code> refers to heterogeneous ante-dependence
covariance structure and a homogeneous version is not provided in
SAS.</p>
</div>
<div id="homogeneous-toep-and-heterogeneous-toeplitz-toeph" class="section level2">
<h2>Homogeneous (<code>toep</code>) and Heterogeneous Toeplitz
(<code>toeph</code>)</h2>
<p>Toeplitz matrices <span class="citation">(Toeplitz 1911)</span> are
diagonal-constant matrices. Here we can model the correlation matrix as
a Toeplitz matrix: <span class="math display">\[
P = \begin{pmatrix}
  1 &amp; \rho_1   &amp; \rho_2 &amp; \cdots &amp; \cdots &amp;
\rho_{m-1} \\
  \rho_1 &amp; 1      &amp; \rho_1 &amp; \ddots &amp;        &amp;
\vdots \\
  \rho_2 &amp; \rho_1      &amp; \ddots &amp; \ddots &amp; \ddots &amp;
\vdots \\
\vdots &amp; \ddots &amp; \ddots &amp; \ddots &amp; \rho_1 &amp; \rho_2
\\
\vdots &amp;        &amp; \ddots &amp; \rho_1    &amp; 1    &amp; \rho_1
\\
\rho_{m-1} &amp; \cdots &amp; \cdots &amp; \rho_2    &amp;
\rho_1    &amp; 1
\end{pmatrix}
\]</span> This means that the correlation between two time points only
depends on the distance between them, i.e. <span class="math display">\[
\rho_{ij} = \rho_{\left\vert i - j\right\vert}
\]</span> and we have correlation parameters <span class="math inline">\(\rho_k\)</span>, <span class="math inline">\(k =
1, \dotsc, m-1\)</span>.</p>
<p>We use a heterogeneous covariance structure to allow for different
within subject variances. So here we can identify <span class="math display">\[
\theta = (\log(\sigma_1), \dotsc, \log(\sigma_m), f(\rho_1), \dotsc,
f(\rho_{m-1}))
\]</span> and we have in total <span class="math inline">\(2m -
1\)</span> variance parameters. This is similar to the heterogeneous
ante-dependence structure, but the correlation parameters are used
differently in the construction of <span class="math inline">\(P\)</span>. Assuming a constant variance yields a
homogeneous Toeplitz covariance structure with total <span class="math inline">\(m\)</span> variance parameters.</p>
</div>
<div id="homogeneous-ar1-and-heterogeneous-ar1h-autoregressive" class="section level2">
<h2>Homogeneous (<code>ar1</code>) and Heterogeneous (<code>ar1h</code>)
Autoregressive</h2>
<p>The autoregressive covariance structure can be motivated by the
corresponding state-space equation <span class="math display">\[
y_{it} = \varphi y_{i,t-1} + \varepsilon_t
\]</span> where the white noise <span class="math inline">\(\varepsilon_t\)</span> has a normal distribution
with mean zero and a constant variance. It can be shown that this gives
correlations <span class="math display">\[
\rho_{ij} = \rho^{\left\vert i - j\right\vert}.
\]</span> where <span class="math inline">\(\rho\)</span> is related to
<span class="math inline">\(\varphi\)</span> and the variance and is the
single correlation parameter here.</p>
<p>Assuming a constant variance in the state-space equation yields a
homogeneous autoregressive covariance structure with total only <span class="math inline">\(k=2\)</span> variance parameters, otherwise we
obtain the heterogeneous autoregressive covariance structure with <span class="math inline">\(k = m + 1\)</span> variance parameters.</p>
</div>
<div id="homogeneous-cs-and-heterogeneous-csh-compound-symmetry" class="section level2">
<h2>Homogeneous (<code>cs</code>) and Heterogeneous (<code>csh</code>)
Compound Symmetry</h2>
<p>The compound symmetry covariance structures assume a constant
correlation between different time points: <span class="math display">\[
\rho_{ij} = \rho
\]</span> where <span class="math inline">\(\rho\)</span> is the single
correlation parameter here.</p>
<p>Assuming a constant variance in the state-space equation yields a
homogeneous compound symmetry covariance structure with total only <span class="math inline">\(k=2\)</span> variance parameters, otherwise we
obtain the heterogeneous compound symmetry covariance structure with
<span class="math inline">\(k = m + 1\)</span> variance parameters.</p>
</div>
</div>
<div id="spatial-covariance-structure" class="section level1">
<h1>Spatial Covariance Structure</h1>
<p>Spatial covariance structures, unlike other covariance structures,
does not require that the timepoints are consistent between subjects.
Instead, as long as the distance between visits can be quantified in
terms of time and/or other coordinates, the spatial covariance structure
can be applied. Euclidean distance is the most common case. For each
subject, the covariance structure can be different. Only homogeneous
structures are allowed (i.e. a common variance is used).</p>
<p>Please note that while printing the summary of an <code>mmrm</code>
fit, the covariance displayed is a 2 * 2 square matrix. As the distance
will be used to derive the corresponding element in that matrix, unit
distance is used here. The distance matrix is</p>
<p><span class="math display">\[
    \begin{pmatrix}
    0 &amp; 1\\
    1 &amp; 0\\
    \end{pmatrix}
\]</span></p>
<div id="spatial-exponential-sp_exp" class="section level2">
<h2>Spatial exponential (<code>sp_exp</code>)</h2>
<p>For spatial exponential, the covariance structure is defined as
follows:</p>
<p><span class="math display">\[
  \rho_{ij} = \rho^{d_{ij}}
\]</span></p>
<p>where <span class="math inline">\(d_{ij}\)</span> is the distance
between time point <span class="math inline">\(i\)</span> and time point
<span class="math inline">\(j\)</span>,</p>
<p>A total number of parameters <span class="math inline">\(k =
2\)</span> is needed:</p>
<p>The parameterization for <span class="math inline">\(\theta\)</span>
is a little different from previous examples. In previous examples,
<span class="math inline">\(\rho\)</span> can take values from -1 to 1,
but here we need to restrict <span class="math inline">\(\rho\)</span>
to (0, 1). Hence we have the following parametrization form.</p>
<p><span class="math display">\[
  \theta = (\log(\sigma), \mathop{\mathrm{logit}}(\rho))
\]</span></p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-Gabriel1962" class="csl-entry">
Gabriel KR (1962). <span>“<span class="nocase">Ante-dependence Analysis
of an Ordered Set of Variables</span>.”</span> <em>The Annals of
Mathematical Statistics</em>, <strong>33</strong>(1), 201–212. <a href="https://doi.org/10.1214/aoms/1177704724">https://doi.org/10.1214/aoms/1177704724.</a>
</div>
<div id="ref-Toeplitz1911" class="csl-entry">
Toeplitz O (1911). <span>“Zur <span>Theorie</span> Der Quadratischen Und
Bilinearen <span>Formen</span> von Unendlichvielen
<span>Veränderlichen</span>.”</span> <em>Mathematische Annalen</em>,
<strong>70</strong>(3), 351–376. <a href="https://doi.org/10.1007/BF01564502">https://doi.org/10.1007/BF01564502.</a>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
